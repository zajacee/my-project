<!DOCTYPE html>
<html lang="sk">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Upravi≈• pr√≠spevok</title>
  <link rel="stylesheet" href="style.css" />
</head>
<style>
    /* Reset styles */
    * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
    }

    /* Ensures the same layout box model for all elements */
    html {
        font-size: 16px; /* Base font size */
    }

    
    .file-button {
        white-space: nowrap;
    }

    /* Body Styling */
    body {
        font-family: Arial, sans-serif;
        line-height: 1.6;
        background-color: #f4f4f4;
        color: #333;
        padding: 1.25rem; /* Padding adjusted */
        max-width: 100%;
        margin: 0 auto; /* Make sure body is centered */
        padding-top: 50px; /* Adjust this value as needed */
    }
    
    header {
background-color: #333;
color: #fff;
padding: 1.25rem;
display: flex;
justify-content: center; /* Centers title */
text-align: center;
position: relative;
height: 80px; /* Set a fixed height */
}

/* Ensure title is visible and centered */
header h1 {
margin: 0;
font-size: 2rem;
cursor: pointer;
text-align: center;
position: absolute;
left: 50%;
transform: translateX(-50%);
}

    /* Header Search Bar Styling */
    #search-bar {
        padding: 0.5rem;
        width: 80%;
        max-width: 300px; /* 300px max width */
        border: 1px solid #ccc;
        border-radius: 0.25rem;
        font-size: 1rem;
        position: absolute;
        right: 1.25rem;
        top: 38%;
        transform: translateY(-50%);
    }

    .top-bar {
display: flex;
justify-content: space-between;
align-items: center;
width: 100%;
}

/* Basic styling for the cookie banner */
.cookie-banner {
display: none; /* Hide it by default */
position: fixed;
bottom: 0;
left: 0;
right: 0;
background-color: #2e3b47;
color: white;
padding: 15px;
text-align: center;
font-family: Arial, sans-serif;
z-index: 1000;
}

.cookie-banner-content {
max-width: 1200px;
margin: 0 auto;
}

.cookie-banner p {
margin: 0;
}

.cookie-banner button {
background-color: #4CAF50;
color: white;
border: none;
padding: 10px 20px;
margin: 10px;
cursor: pointer;
}

.cookie-banner button:hover {
background-color: #45a049;
}

.cookie-banner a {
color: #00bcd4;
text-decoration: underline;
}

.cookie-banner a:hover {
text-decoration: underline;
}

/* Add this to style the words "S√∫hlas√≠m" and "Nastavenia" in blue */
.blue-text {
color: #4CAF50;
font-weight: bold; /* Optional: Make the text bold */
}

/* Add this CSS to make the buttons appear in one line */
.cookie-buttons {
display: flex;
justify-content: center; 
gap: 200px; /* Adjust gap between buttons */
}

/* Style for the buttons */
#accept-cookies, #cookie-settings {
padding: 10px 20px; /* Adjust button padding */
font-size: 16px; /* Button font size */
cursor: pointer; /* Add pointer cursor on hover */
flex: 1; /* This makes both buttons take equal width */
text-align: center; /* Centers text inside the buttons */
min-width: 150px; /* Optional: sets a minimum width for the buttons */
}

#login-button {
display: flex;
align-items: center;
justify-content: center; 
gap: 8px;  /* Space between text and icon */
position: absolute;
top: -75px;
right: 20px;
padding: 8px 10px;
width: 160px;  /* Fixed width */
height: 40px;  /* Fixed height */
background-color: white;
color: black;
border: 1px solid #ddd;
border-radius: 8px;
cursor: pointer;
font-size: 1rem;
font-weight: bold;
}

#login-button img {
width: 26px;  /* Adjust icon size */
height: 24px;
}

#login-button:hover {
background-color: #f0f0f0;
}

.dropdown {
display: none;
position: absolute;
top: 0px; /* Adjust dropdown positioning */
right: 20px;
background: white;
border: 1px solid #ddd;
border-radius: 5px;
box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
width: 150px;  /* Fixed width */
height: 80px;  /* Auto height to fit content */
text-align: center;
z-index: 1000;
padding: 5px 0; /* Adjust padding inside the dropdown */
}

.dropdown button {
width: 100%;
padding: 2px 0; /* Reduce space inside buttons */
border: none;
background: none;
cursor: pointer;
font-size: 1rem;
white-space: nowrap; /* Prevent text wrapping */
display: flex;
align-items: center; /* Align text and icon properly */
justify-content: center; /* Center text horizontally */
color: black;
text-align: left;
line-height: 1.5; /* Reduce spacing between text lines */
margin-top: 5px; /* Moves the text up */
   }

.dropdown button:first-child {
margin-bottom: 3px; /* Reduce space between buttons */
}

.dropdown button img {
margin-right: 5px; /* Adjust spacing between icon and text */
}

.dropdown button:hover {
background-color: #f0f0f0;
}

.notification-username {
  color: #007bff;
  font-weight: bold;
}

/* Ensure username, icon, and date are in one line */
.content-meta {
display: flex;
align-items: center;
font-size: 0.9rem;
color: #555;
gap: 10px; /* Adds space between elements */
flex-wrap: wrap; /* Prevents overlap on small screens */
}

.content-meta small {
font-size: 0.9rem; /* Adjust size (default small is ~0.8rem) */
}

.user-link {
text-decoration: none;
font-size: 0.9rem;
color: #007bff;
display: inline-flex;
align-items: center;
gap: 5px;
}

.user-link:hover {
color: #0056b3;
text-decoration: underline;
}

.small-user-icon {
width: 16px;
height: 14px;
border-radius: 50%;
vertical-align: middle;
}


    /* Custom Alert Modal */
.custom-alert-modal {
  display: none;
  position: fixed;
  z-index: 1;
  left: 0;
  top: 0;
  width: 100%;
  height: 100%;
  background-color: rgba(0, 0, 0, 0.5);
  padding-top: 100px;
}

.alert-box {
  background-color: white;
  margin: 0 auto;
  padding: 20px;
  border-radius: 8px;
  width: 80%;
  max-width: 400px;
  text-align: center;
}

.alert-box button {
    width: 100%;
    padding: 10px 20px;
  background-color: #3498db;
  color: white;
  border: none;
  border-radius: 4px;
  cursor: pointer;
}

.alert-box button:hover {
  background-color: #2980b9;
}

    .error-message {
position: relative;
top: -10px;  /* Moves it up */
left: 10px; /* Moves it to the right */
color: red;
font-size: 0.9em;
white-space: nowrap; /* Prevents wrapping */
}
    /* Sidebar Styling */
    #sidebar {
        background-color: #2c3e50;
        color: #fff;
        padding: 1.25rem;
        width: 240px; /* Sidebar fixed width */
        position: fixed;
        top: 0;
        left: 0;
        height: 100%;
    }

    #sidebar h2 {
        font-size: 1.5rem;
        margin-bottom: 1rem;
        margin-top: 20px; /* Moved closer to the top */
    }

    #sidebar ul {
        list-style: none;
        margin-top: 5px;
    }

    #sidebar ul li {
        margin-bottom: 10px;
    }

    #sidebar ul li a {
        color: #fff;
        text-decoration: none;
        font-size: 1.1rem;
    }

    #sidebar ul li a.bold {
        font-weight: bold;
    }

    #sidebar ul li a:hover {
        color: #f39c12;
    }

    /* Sidebar "Domov" link styling */
    #sidebar h2 a {
        color: #517dcf; /* Default color */
        text-decoration: none;
        font-size: 1.5rem;
        font-weight: bold; /* Make Domov link bold */
    }

    #sidebar h2 a:hover {
        color: #f39c12; /* Change color on hover */
    }

    /* Main Content Area */
    #content {
        margin-left: 240px; /* Match sidebar width */
        padding: 20px;
        max-width: calc(100% - 240px); /* Avoid overflow */
    }

    /* Content Heading Styling */
    #content h2 {
        font-size: 1.5rem; /* 28.8px */
        margin-bottom: 20px;
    }

    .content-item p {
max-height: 4.5em; /* Adjust based on your design */
overflow: hidden;
text-overflow: ellipsis;
display: -webkit-box;
-webkit-line-clamp: 3; /* Limit to 3 lines */
-webkit-box-orient: vertical;
line-clamp: 3; /* For future standards-compliant browsers */

}

.read-more {
color: #3498db;
cursor: pointer;
text-decoration: underline;
}

.read-more:hover {
color: #2980b9;
}

/* kotva pre absol√∫tne panel */
.comment-input-wrap { position: relative; row-gap: 0; width: 100%; }

/* tlaƒçidlo vƒæavo + medzera pod emoji */
.emoji-wrap {
  display: flex; align-items: center; gap: 0;
  margin-top: -40px;    /* posunie tlaƒçidlo bli≈æ≈°ie k textarea, ako m√°≈° inde */
  justify-content: flex-start;
}

/* vzhƒæad tlaƒçidla */
#emoji-toggle-write{
  font-size: 1rem;
  display: inline-flex; align-items: center; gap: 0;
  background: #f7fafc; border: 1px solid #94a3b8; color: #1f2937;
  font-weight: 600; padding: 8px 12px; border-radius: 10px;
  cursor: pointer; box-shadow: 0 1px 2px rgba(0,0,0,.06);
  transition: background .15s, border-color .15s, box-shadow .15s, transform .05s;
}
#emoji-toggle-write:hover { background:#eef2f7; border-color:#64748b; box-shadow:0 2px 6px rgba(0,0,0,.08); }
#emoji-toggle-write:active { transform:translateY(1px); }
#emoji-toggle-write:focus-visible { outline:0; box-shadow:0 0 0 3px rgba(59,130,246,.35); border-color:#3b82f6; }

/* panel zarovno ƒæav√©ho okraja textarea ‚Äì na ≈°√≠rku textarey */
.emoji-panel {
  position: absolute; z-index: 1200; left: 0; right: auto; top: calc(100% + 6px);
  width: 100%; max-width: 100%;
  background: #fff; border: 1px solid #ddd; border-radius: 10px; box-shadow: 0 6px 18px rgba(0,0,0,.12);
  padding: 8px; max-height: 260px; overflow: auto; display: none;
}

/* mrie≈æka a tlaƒçidl√° */
.emoji-grid{ display:grid; grid-template-columns:repeat(14,1fr); gap:4px; }
.emoji-btn{ font-size:18px; line-height:1; padding:4px; background:transparent; border:none; cursor:pointer; border-radius:6px; }
.emoji-btn:hover{ background:#f0f0f0; }

@media (max-width: 600px){
  .emoji-grid{ grid-template-columns:repeat(10,1fr); }
  .emoji-btn{ font-size:16px; padding:3px; }
}


    /* Content Form */
    #content form {
        background-color: #fff;
        padding: 20px;
        border-radius: 5px;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        width: 100%;
        max-width: 900px; /* Max width for content */
        margin: 0 auto;
    }

    /* Form Inputs & Textareas */
    #content form input[type="text"],
    #content form select,
    #content form textarea {
        width: 100%;
        padding: 10px;
        margin-bottom: 15px;
        border: 1px solid #ccc;
        border-radius: 4px;
        font-size: 1rem;
        display: block;
    }

    /* Style for the textarea */
    #content form textarea {
        resize: vertical;
        overflow-x: hidden;
        min-height: 120px;
        width: 91%;
        margin-left: 2cm;
    }

    /* Make Labels for T√©ma, Obsah, Kateg√≥ria Bold */
    #content form label {
        font-weight: normal; /* Default to normal for all labels */
    }

    #content form label[for="title"], 
    #content form label[for="content-text"], 
    #content form label[for="category"] {
        font-weight: bold; /* Bold only for specific labels */
    }

    /* File Upload Styling */
    .file-upload {
        display: flex;
        align-items: center;
    }

    .file-upload .file-button {
        display: inline-flex;
        align-items: center;
        padding: 8px 12px;
        background-color: #3498db;
        color: #fff;
        cursor: pointer;
        border-radius: 4px;
        margin-right: 10px;
    }

    /* Button Styling */
    button {
        padding: 20px 40px;
        background-color: #3498db;
        color: #fff;
        border: none;
        border-radius: 6px;
        cursor: pointer;
        font-size: 18px;
        width: auto;
        display: block;
        margin-left: auto;
        margin-top: 30px;
        font-weight: bold;
    }

    button:hover {
        background-color: #2980b9;
    }

    /* Recent Content Section */
    #recent-content {
        margin-top: 50px;
        padding: 20px;
        background-color: #fff;
        border-radius: 5px;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        display: flex;
flex-direction: column;
    }

    #recent-content .content-item p {
        word-wrap: break-word;
        overflow-wrap: break-word;
        white-space: normal;
    }

    #recent-content .content-item p:first-of-type {
        margin-bottom: 10px; /* Adds space between content and category */
    }

   #recent-content-items {
order: 1;
}

#load-more-container {
order: 2;
text-align: center;
}

#load-more-button {
display: none;
cursor: pointer;
font-size: 18px;
color: #3498db;
display: flex;
justify-content: center;
align-items: center;
gap: 8px;
}
#load-more-button:hover {
font-weight: bold;
}

    /* Styling for each content item */
    .content-item {
        margin-bottom: 20px; /* Adds space between each item */
        padding: 15px; /* Adds some padding inside each content item */
        background-color: #fafafa; /* Light background to separate from others */
        border-radius: 5px; /* Rounded corners for each content item */
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05); /* Subtle shadow effect */
    }

    /* Adds a small border to make them more distinct */
    .content-item:not(:last-child) {
        border-bottom: 1px solid #ddd;
    }

    /* Justify the text in the recent content section */
    #recent-content .content-item p {
        text-align: justify; /* Ensures text is evenly spaced between the margins */
        font-size: 1rem; /* Adjust the size of the content text */
    }

    /* Recent Content Section Heading */
    #recent-content h3 {
        font-size: 1.5rem; /* Make the "Ned√°vno pridan√©" heading larger */
        margin-bottom: 20px; /* Space between heading and content */
    }


    .thumbnail-placeholder {
    display: flex;
    flex-wrap: wrap;
    align-items: center;
    color: #888;
    }

    .thumb-item {
    margin-right: 10px;
    margin-bottom: 10px;
}

/* Container for content item */
.content-item {
display: flex;
align-items: flex-start;
gap: 15px; /* Space between image and text */

    /* Thumbnail container */
.content-thumbnail {
flex-shrink: 0;
width: 120px; /* Adjust size */
height: 120px; /* Adjust size */
overflow: hidden;
border-radius: 5px;
}

/* Thumbnail image */
.thumbnail {
width: 100%;
height: 100%;
object-fit: contain; /* Show full image without cropping */
border-radius: 5px;
background-color: #fff; /* Makes empty areas more neutral */
}

/* Content text */
.content-text {
flex-grow: 1;
}

/* Footer Styling */
footer {
  text-align: center;
  padding: 20px;
  background-color: #333;
  color: #fff;
  margin-top: 20px;
}

.footer-link {
  font-size: 14px;
  color: #fff; /* Set link color */
text-decoration: underline; /* Remove the underline */
}

.footer-link:hover {
color: #f39c12; /* Highlight color on hover */
}

.copyright p {
font-size: 14px;
margin: 0;



    /* Media Queries for Scaling */
    @media screen and (max-width: 768px) {
        html {
            font-size: 14px; /* Scale down on small screens */
        }

        #sidebar {
            width: 200px; /* Reduce sidebar width on small screens */
        }

        #content {
            margin-left: 200px; /* Adjust content area margin */
            padding: 15px;
        }

        button {
            padding: 15px 30px;
        }
    }
</style>
<script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
<script src="notifications.js" defer></script>
</head>
<body>
  <header>
    <div class="top-bar">
        <h1><a href="index.html" style="text-decoration: none; color: inherit;">DajToVon</a></h1>
        <input type="text" id="search-bar" placeholder="Hƒæada≈•...">

        <div class="user-menu">
          <!-- üîî Notification Bell inside user-menu -->
      <!-- üîî Notification Bell positioned top right -->
<div id="notification-container" class="notification-container" style="display: none; position: absolute; top: -45px; right: 200px; font-size: 1.5rem; cursor: pointer;">
  <span id="notification-bell" title="Notifik√°cie">üîî</span>
  <span id="bell-dot" style="
    position: absolute;
    top: 0;
    right: 0;
    width: 10px;
    height: 10px;
    background: red;
    border-radius: 50%;
    display: none;
  "></span>

<div id="notification-popup" style="
  display: none;
  position: absolute;
  top: 30px;
  right: 0;
  background: white;
  border: 1px solid #ccc;
  border-radius: 5px;
  box-shadow: 0 2px 5px rgba(0,0,0,0.2);
  padding: 10px;
  min-width: 300px;
  max-width: 90vw;
  white-space: normal;
  word-wrap: break-word;
  overflow-wrap: break-word;
  color: black;
  z-index: 1000;
">
  <h4 style="margin: 0 0 10px; font-size: 1rem; font-weight: bold; font-family: Arial, sans-serif; color: black;">üîî Notifik√°cie</h4>
  <ul id="notification-list" style="list-style: none; padding: 0; margin: 0; font-size: 0.9rem;"></ul>
</div>
</div>
          <button id="login-button">
            <img id="user-icon" src="user-icon.png" alt="User Icon">
            <span id="login-text">Prihl√°si≈•</span>
          </button>
          <div class="dropdown" id="logout-dropdown">
            <button id="my-content" onclick="window.location.href='userprofile.html'">Moje pr√≠spevky</button>
            <button id="logout-option">
              <img src="logout-icon.png" alt="Logout Icon" style="width: 20px; height: 20px; margin-right: 8px;">
              Odhl√°si≈•
            </button>
          </div>
        </div>
      </div>
  </header>

   <!-- Custom Alert Modal -->
<div id="custom-alert-modal" class="custom-alert-modal">
  <div class="alert-box">
    <p id="alert-message"></p>
    <button id="alert-ok-button">OK</button>
  </div>
</div>

  <div id="sidebar">
    <h2><a href="index.html" class="sidebar-link">Domov</a></h2>
    <h2>Kateg√≥rie</h2>
    <ul>
      <li><a href="vedomosti.html">Vedomosti</a></li>
      <li><a href="skusenosti.html">Sk√∫senosti</a></li>
      <li><a href="praca.html">Pr√°ca</a></li>
      <li><a href="predmety.html">Predmety</a></li>
      <li><a href="ine.html">In√©</a></li>
    </ul>
    <h2><a href="contact.html" class="sidebar-link">Kontakt</a></h2>
  </div>

  <div id="content">
    <h2>Upravi≈• pr√≠spevok</h2>
    <form id="edit-form" enctype="multipart/form-data">
      
      <label for="title" class="bold-text">T√©ma</label>
      <input type="text" id="title" name="topic" placeholder="N√°zov t√©my" required
        title="Povinn√© pole"
        oninvalid="this.setCustomValidity(this.value ? '' : 'Povinn√© pole')"  
        oninput="this.setCustomValidity('')" />
  
      <label for="content-text" class="bold-text">Obsah</label>

<div class="comment-input-wrap">
  <textarea id="content-text" name="content" placeholder="Sem nap√≠≈°te obsah..." required
    title="Povinn√© pole"
    oninvalid="this.setCustomValidity(this.value ? '' : 'Povinn√© pole')" 
    oninput="this.setCustomValidity('')"></textarea>

  <!-- Emoji UI (rovnak√© ako na vytv√°racej str√°nke) -->
  <div class="emoji-wrap">
    <button id="emoji-toggle-write" type="button" aria-haspopup="dialog" aria-expanded="false" aria-label="Vybra≈• emoji">üòä‚ù§Ô∏èüôè</button>
    <div id="emoji-panel-write" class="emoji-panel" role="dialog" aria-label="Panel s emoji">
      <div class="emoji-grid" id="emoji-grid-write"></div>
    </div>
  </div>
</div>

  
      <label for="category" class="bold-text">Kateg√≥ria</label>
      <select id="category" name="category" required>
        <option value="vedomosti">Vedomosti</option>
        <option value="skusenosti">Sk√∫senosti</option>
        <option value="praca">Pr√°ca</option>
        <option value="predmety">Predmety</option>
        <option value="ine">In√©</option>
      </select>
  
      <div class="file-upload">
        <input type="file" id="images" name="images" multiple accept="image/*" style="display:none;">
        <label for="images" class="file-button">
          <span>Nahra≈• nov√© obr√°zky</span>
          <span class="file-icon">üìÅ</span>
        </label>
        <div id="thumbnail-container" class="thumbnail-placeholder"></div>
      </div>

      <div id="upload-progress" style="display: none; margin-top: 20px;">
        <div style="height: 10px; background: #ddd; border-radius: 4px; overflow: hidden;">
          <div id="progress-bar" style="height: 100%; width: 0%; background: #3498db;"></div>
        </div>
        <small id="progress-text" style="color: #555;">Nahr√°vam...</small>
      </div>

       
           <button type="submit">Ulo≈æi≈• zmeny</button>
    </form>
  
    <div id="message" style="margin-top: 20px;"></div>
  </div>

  <footer>
    <div class="footer-content">
      <div class="footer-links">
        <a href="terms.pdf" target="_blank" class="footer-link">V≈°eobecn√© podmienky</a> |
        <a href="privacy.pdf" target="_blank" class="footer-link">Ochrana osobn√Ωch √∫dajov</a>
      </div>
      <div class="copyright">
        <p>&copy; 2025 DajToVon</p>
      </div>
    </div>
  </footer>

  <script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.js"></script>
  <script>
  document.addEventListener('DOMContentLoaded', () => {
    let selectedFiles = [];
    const thumbnailContainer = document.getElementById('thumbnail-container');
    const fileInput = document.getElementById('images');
    const form = document.getElementById('edit-form');
    const button = form.querySelector('button[type="submit"]');
    const messageDiv = document.getElementById('message');
    const titleInput = document.getElementById('title');
    const params = new URLSearchParams(window.location.search);
    const contentId = params.get('contentId');
  
    // Alert Modal
    function showAlert(message, callback = null) {
      const modal = document.getElementById("custom-alert-modal");
      const alertMessage = document.getElementById("alert-message");
      const alertButton = document.getElementById("alert-ok-button");
      alertMessage.textContent = message;
      modal.style.display = "block";
  
      const newAlertButton = alertButton.cloneNode(true);
      newAlertButton.id = "alert-ok-button";
      alertButton.parentNode.replaceChild(newAlertButton, alertButton);
  
      newAlertButton.addEventListener("click", () => {
        modal.style.display = "none";
        if (typeof callback === "function") callback();
      });
    }
  
    // Title Length Check
    const titleError = document.createElement('span');
    titleError.textContent = "Maximum 80 znakov";
    titleError.classList.add('error-message');
    titleError.style.display = 'none';
    titleInput.insertAdjacentElement('afterend', titleError);
  
    titleInput.addEventListener('input', () => {
      if (titleInput.value.length > 80) {
        titleInput.value = titleInput.value.slice(0, 80);
        titleError.style.display = 'block';
      } else {
        titleError.style.display = 'none';
      }
    });
  
    // File Preview + Remove Button
    function updateFileListDisplay() {
      thumbnailContainer.innerHTML = '';
  
      if (selectedFiles.length === 0) {
        thumbnailContainer.innerHTML = '<p style="color: #888;">Neboli vybrat√© ≈æiadne s√∫bory</p>';
        return;
      }
  
      selectedFiles.forEach(({ file, id, isExisting }) => {
        const wrapper = document.createElement('div');
        wrapper.className = 'thumb-item';
        wrapper.dataset.id = id;
        wrapper.style.cssText = 'position: relative; width: 100px; height: 100px; border: 1px solid #ccc; border-radius: 6px; overflow: hidden; flex-shrink: 0;';
  
        const img = document.createElement('img');
        img.style.width = '100%';
        img.style.height = '100%';
        img.style.objectFit = 'contain';
        if (isExisting) {
          img.src = file;
        } else {
          const reader = new FileReader();
          reader.onload = e => img.src = e.target.result;
          reader.readAsDataURL(file);
        }
  
        const removeBtn = document.createElement('div');
        removeBtn.textContent = '‚ùå';
        removeBtn.style.cssText = 'position: absolute; top: 4px; right: 4px; background-color: rgba(255,255,255,0.8); border-radius: 50%; padding: 2px 5px; font-size: 14px; cursor: pointer;';
        removeBtn.onclick = () => {
          selectedFiles = selectedFiles.filter(f => f.id !== id);
          updateFileListDisplay();
        };

        const dragHandle = document.createElement('div');
        dragHandle.textContent = '‚ú•';  // Four-pointed star for drag
dragHandle.title = 'Presu≈à obr√°zok';
dragHandle.classList.add('drag-handle');
dragHandle.style.position = 'absolute';
dragHandle.style.top = '4px';
dragHandle.style.left = '4px';
dragHandle.style.cursor = 'grab';
dragHandle.style.backgroundColor = 'rgba(255,255,255,0.8)';
dragHandle.style.borderRadius = '4px';
dragHandle.style.padding = '2px 5px';
dragHandle.style.fontSize = '14px';
dragHandle.style.fontWeight = 'bold';

        
        wrapper.appendChild(img);
        wrapper.appendChild(removeBtn);
        wrapper.appendChild(dragHandle);
        thumbnailContainer.appendChild(wrapper);
      });
  
      if (!thumbnailContainer.classList.contains('sortable-initialized')) {
        Sortable.create(thumbnailContainer, {
          animation: 150,
          onEnd: () => {
            selectedFiles = Array.from(thumbnailContainer.children).map(el => {
              return selectedFiles.find(f => f.id === el.dataset.id);
            }).filter(Boolean);
          }
        });
        thumbnailContainer.classList.add('sortable-initialized');
      }
    }
  
    // Load existing content
    if (!contentId) {
      messageDiv.textContent = "Ch√Ωba ID obsahu.";
      form.style.display = 'none';
    } else {
      fetch('http://localhost:3000/user-content', { method: 'GET', credentials: 'include' })
        .then(res => res.json())
        .then(data => {
          const contentData = data.userContent.find(c => c.content.id === contentId);
          if (!contentData) throw new Error("Pr√≠spevok nebol n√°jden√Ω");
  
          const { topic, content, category, images = [] } = contentData.content;
          document.getElementById('title').value = topic;
          document.getElementById('content-text').value = content;
          document.getElementById('category').value = category;
  
          images.forEach(url => {
  const id = crypto.randomUUID();
  const img = new Image();
  img.src = url;

  // Fetch HEAD to get content-length (size in bytes)
  fetch(url, { method: 'HEAD' })
    .then(res => {
      const size = parseInt(res.headers.get("Content-Length")) || 0;
      selectedFiles.push({ file: url, id, isExisting: true, size });
      updateFileListDisplay();
    })
    .catch(() => {
      // If size can't be determined, assume large value to be safe
      selectedFiles.push({ file: url, id, isExisting: true, size: 1024 * 1024 }); // 1MB fallback
      updateFileListDisplay();
    });
});
  
          updateFileListDisplay();
        })
        .catch(err => {
          console.error(err);
          messageDiv.textContent = "Chyba pri naƒç√≠tan√≠ obsahu.";
        });
    }
  
   const MAX_TOTAL_SIZE_MB = 5;

    // File select handler
    fileInput.addEventListener('change', e => {
  const picked = Array.from(e.target.files);

  // ‚úÖ odmietni ne-obr√°zky hneƒè (PDF, TXT, ...)
  const invalid = picked.filter(f => !f.type.startsWith('image/'));
  if (invalid.length) {
    showAlert('Povolen√© s√∫ iba obrazov√© s√∫bory');
    fileInput.value = '';
    return;
  }

   const newFiles = picked.map(file => ({
    file,
    id: crypto.randomUUID(),
    isExisting: false
  }));

  const totalSize = [...selectedFiles, ...newFiles].reduce((acc, item) => {
  if (item.isExisting) return acc + (item.size || 0);   // existing URL -> size z HEAD
  return acc + (item.file?.size || 0);                  // nov√© -> File.size
}, 0);

  const totalSizeMB = totalSize / (1024 * 1024);
  if (totalSizeMB > MAX_TOTAL_SIZE_MB) {
    showAlert(`Maxim√°lna povolen√° veƒækos≈• s√∫borov je ${MAX_TOTAL_SIZE_MB} MB.`);
    fileInput.value = '';
    return;
  }

 // 3) duplicity
  newFiles.forEach(newFile => {
    const exists = selectedFiles.some(existing =>
      existing.file?.name === newFile.file.name &&
      existing.file?.size === newFile.file.size &&
      existing.file?.lastModified === newFile.file.lastModified
    );
    if (!exists) selectedFiles.push(newFile);
  });
  
      fileInput.value = '';
      updateFileListDisplay();
    });
    
  
    // Form submit with real-time progress
    form.addEventListener('submit', e => {
      e.preventDefault();
      button.disabled = true;
      button.style.opacity = 0.6;
  
      const formData = new FormData(form);
      const keepImageUrls = selectedFiles.filter(f => f.isExisting).map(f => f.file);
      formData.append('existingImages', JSON.stringify(keepImageUrls));
      selectedFiles.filter(f => !f.isExisting).forEach(f => formData.append('images', f.file));
      formData.set('date', new Date().toISOString());
  
      const xhr = new XMLHttpRequest();
      xhr.upload.onprogress = function (event) {
        if (event.lengthComputable) {
          const percent = Math.round((event.loaded / event.total) * 100);
          document.getElementById('progress-bar').style.width = `${percent}%`;
          document.getElementById('progress-text').textContent = `Nahr√°vam... ${percent}%`;
        }
      };
  
      xhr.onreadystatechange = function () {
        if (xhr.readyState === XMLHttpRequest.DONE) {
            button.disabled = false;
          button.style.opacity = 1;
  
          try {
            const data = JSON.parse(xhr.responseText);
            if (xhr.status === 200 && data.success) {
              showAlert("Pr√≠spevok bol √∫spe≈°ne upraven√Ω", () => window.location.href = 'userprofile.html');
            } else {
  showAlert(
    data.message || `Nepodarilo sa ulo≈æi≈• zmeny. (HTTP ${xhr.status})`
  );
}
          } catch (err) {
            console.error(err);
            showAlert("Neoƒçak√°van√° chyba pri spracovan√≠ odpovede.");
          }
        }
      };
  
      xhr.onerror = function () {
        button.disabled = false;
        button.style.opacity = 1;
        showAlert("Chyba pri odosielan√≠ √∫dajov.");
      };
  
      document.getElementById('upload-progress').style.display = 'block';
      xhr.open('PUT', `http://localhost:3000/edit-content/${contentId}`, true);
      xhr.withCredentials = true;
      xhr.send(formData);
    });
  
    // Search Bar
    document.getElementById('search-bar').addEventListener('keypress', (event) => {
      if (event.key === 'Enter') {
        event.preventDefault();
        const query = event.target.value.trim();
        if (query !== '') window.location.href = `search-results.html?q=${encodeURIComponent(query)}`;
      }
    });
  
    // Login/Logout Dropdown
    const loginButton = document.getElementById('login-button');
    const loginText = document.getElementById('login-text');
    const logoutDropdown = document.getElementById("logout-dropdown");
    const logoutOption = document.getElementById("logout-option");
  
    fetch('http://localhost:3000/api/me', { method: 'GET', credentials: 'include' })
      .then(res => res.json())
      .then(data => {
        if (data.username) {
          loginText.textContent = data.username;
          loginButton.addEventListener('click', (e) => {
            e.stopPropagation();
            logoutDropdown.style.display = logoutDropdown.style.display === 'block' ? 'none' : 'block';
          });
        }
      })
      .catch(() => {
        loginButton.addEventListener('click', () => {
          const currentUrl = window.location.href;
          window.location.href = `login.html?return=${encodeURIComponent(currentUrl)}`;
        });
      });
  
    document.addEventListener("click", (e) => {
      if (!loginButton.contains(e.target) && !logoutDropdown.contains(e.target)) {
        logoutDropdown.style.display = "none";
      }
    });
  
    logoutOption.addEventListener("click", () => {
      fetch("http://localhost:3000/logout", {
        method: "POST",
        credentials: "include"
      }).then(() => {
        loginText.textContent = "Prihl√°si≈•";
        logoutDropdown.style.display = "none";
        window.location.reload();
      }).catch(err => {
        console.error("Logout error:", err);
        alert("Chyba pri odhlasovan√≠.");
      });
    });
  });

(function setupEmojiPickerForWriter(){
  const textarea = document.getElementById('content-text');
  const toggle   = document.getElementById('emoji-toggle-write');
  const panel    = document.getElementById('emoji-panel-write');
  const grid     = document.getElementById('emoji-grid-write');
  if (!textarea || !toggle || !panel || !grid) return;

  const EMOJIS = [
    'üòÄ','üòÉ','üòÑ','üòÅ','üòÜ','ü•π','ü§£','üòÇ','üôÇ','üôÉ','üòâ','üòä','üòá','ü•∞','üòç','ü§©','üòò','üòó','üòô','üòö',
    'üòã','üòõ','üòú','ü§™','üòù','ü´†','ü§ó','ü§≠','ü§´','ü§î','ü´°','ü§ê','ü§®','üòê','üòë','üò∂','ü´•','üòè','üòí','üôÑ',
    'üò¨','üò¥','ü§§','üò™','üòÆ','üòØ','üò≤','ü•±','ü§í','ü§ï','ü§ß','ü•µ','ü•∂','ü§Æ','ü§¢','üòµ','ü§Ø','üòé','ü§ì',
    'üëç','üëé','üëè','üôå','ü§ù','üôè','üí™','üî•','‚ú®','üéâ','‚úÖ','‚ùå','‚ù§Ô∏è','üß°','üíõ','üíö','üíô','üíú','üñ§','ü§ç'
  ];
  grid.innerHTML = EMOJIS.map(e => `<button type="button" class="emoji-btn" data-e="${e}" aria-label="${e}">${e}</button>`).join('');

  function insertAtCursor(el, text) {
    el.focus();
    const s = el.selectionStart ?? el.value.length;
    const e = el.selectionEnd ?? el.value.length;
    el.value = el.value.slice(0, s) + text + el.value.slice(e);
    const caret = s + text.length;
    el.setSelectionRange(caret, caret);
    el.dispatchEvent(new Event('input', { bubbles: true }));
  }

  function openPanel()  { panel.style.display = 'block'; toggle.setAttribute('aria-expanded','true'); document.addEventListener('click', onDocClick); }
  function closePanel() { panel.style.display = 'none';  toggle.setAttribute('aria-expanded','false'); document.removeEventListener('click', onDocClick); }
  function onDocClick(ev){ if (!panel.contains(ev.target) && ev.target !== toggle) closePanel(); }

  toggle.addEventListener('click', () => (panel.style.display === 'block' ? closePanel() : openPanel()));
  grid.addEventListener('click', (e) => {
    const b = e.target.closest('.emoji-btn');
    if (b) { insertAtCursor(textarea, b.dataset.e); closePanel(); }
  });
})();

  </script>
  <script>
  document.addEventListener('DOMContentLoaded', () => {
    initializeNotifications();
  });
</script>
 </body>
</html>
